<p class="m-0 fs-1">Configurações</p>
<p class="mb-3">Configurações do site.</p>

<pre>{{ configs.destaques.[1]._id }}</pre>

<div class="row">
	<div class="col-xs-12">
		<div class="card bg-secondary text-light mb-3">
			<div class="card-header">
				<h5 class="card-title p-0 m-0">Título do site</h5>
			</div>
			<div class="card-body">
				<div class="input-group p-0 m-0">
					<input type="text" class="form-control" placeholder="Título do site"
						value="{{ configs.site_title }}" data-input="site_title">
					<button class="btn btn-primary" type="button" data-btn="save_title">Salvar</button>
				</div>
			</div>
		</div>
	</div>
	<div class="col">
		<div class="row">
			<div class="col-md-4">
				<div class="card bg-secondary text-light mb-3">
					<div class="card-header">
						<h5 class="card-title m-0 p-0">Banner principal</h5>
					</div>
					<div class="card-body" data-id="default_banner">

						<div class="input-group mb-3">
							<select class="form-select" id="select_default_banner">
								{{#each emps}}
								<option value="{{_id}}">{{title}}</option>
								{{/each}}
							</select>
							<button class="btn btn-primary" type="button" data-btn="save_db">Salvar</button>
						</div>

						<div data-id="empreendimento_box">
							<img src="/images/empreendimentos/{{configs.default_banner._id}}/{{configs.default_banner.default_image.filename}}"
								class="card-img-top" id="db_image" alt="test">
							<p class="card-title text-center py-1 m-0" id="db_title">{{configs.default_banner.title}}
							</p>
						</div>

					</div>
					<div class="card-footer"></div>
				</div>
			</div>
			<div class="col-md-8">
				<div class="card bg-secondary text-light ">
					<div class="card-header">
						<h5 class="card-title m-0 p-0">Empreendimentos em destaque</h5>
					</div>
					<div class="card-body row" data-id="destaques">
						<div class="col">
							<div class="card">
								<div class="card-title"></div>
								<div class="card-body">
									<select class="form-select" id="dest_a">
										{{#each emps}}
										<option value="{{_id}}">{{title}}</option>
										{{/each}}
									</select>
								</div>
							</div>
						</div>
						<div class="col">
							<div class="card">
								<div class="card-title"></div>
								<div class="card-body">
									<select class="form-select" id="dest_b">
										{{#each emps}}
										<option value="{{_id}}">{{title}}</option>
										{{/each}}
									</select>
								</div>
							</div>
						</div>
						<div class="col">
							<div class="card">
								<div class="card-title"></div>
								<div class="card-body">
									<select class="form-select" id="dest_c">
										{{#each emps}}
										<option value="{{_id}}">{{title}}</option>
										{{/each}}
									</select>
								</div>
							</div>
						</div>
					</div>
					<div class="card-footer"></div>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="toast-container position-fixed" id="message-box">
	<div class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true">
		<div class="d-flex">
			<div class="toast-body" class="h2">
				<p class="lead p-1 m-0 text-dark" id="message-text"></p>
			</div>
			<button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Fechar"></button>
		</div>
	</div>
</div>


<script>
	const ShowMessage = params => {
		const MessageBox = document.querySelector('#message-box div.toast')
		const MessageText = document.querySelector('#message-text')
		const Button = document.querySelector('[data-bs-dismiss="toast"]')
		MessageText.innerHTML = params.msg
		MessageBox.classList.add(`show`, `${params.alertClass}`)
		Button.onclick = () => MessageBox.classList.remove('show')
		MessageBox.onclick = () => MessageBox.classList.remove('show')
	}

	const RenderDefaultBanner = async e => {
		e.preventDefault()
		const _id = e.target.value
		const Empreendimento = await fetch(`/api/empreendimentos/${_id}`)
		const Response = await Empreendimento.json()

		db_image.src = `/images/empreendimentos/${_id}/${Response.default_image.filename}`
		db_title.innerHTML = `${Response.title}`
	}

	select_default_banner.value = '{{ configs.default_banner._id }}'
	document.querySelector('#dest_a').value = '{{ configs.destaques.0._id }}'
	document.querySelector('#dest_b').value = '{{ configs.destaques.1._id }}'
	document.querySelector('#dest_c').value = '{{ configs.destaques.2._id }}'

	select_default_banner.addEventListener('change', RenderDefaultBanner)
	CheckAndDisable()
	const RenderDestaques = async e => {
		e.preventDefault()
		const _idA = e.target.value
		const EmpreendimentoA = await fetch(`/api/empreendimentos/${_idA}`)
		const ResponseA = await EmpreendimentoA.json()

		const _idB = e.target.value
		const EmpreendimentoB = await fetch(`/api/empreendimentos/${_idB}`)
		const ResponseB = await EmpreendimentoB.json()

		const _idC = e.target.value
		const EmpreendimentoC = await fetch(`/api/empreendimentos/${_idC}`)
		const ResponseC = await EmpreendimentoC.json()
	}

	document.querySelector('[data-btn="save_db"]').addEventListener('click', async e => {
		e.preventDefault()
		const default_banner = select_default_banner.value
		const SaveDB = await fetch('/api/settings', {
			method: 'PUT',
			headers: {'Content-Type': 'application/json'},
			body: JSON.stringify({ default_banner })
		})
		const Response = await SaveDB.json()
		ShowMessage({ msg: Response.msg, alertClass: 'bg-warning' })
	})

	document.querySelector('[data-btn="save_title"]').addEventListener('click', async e => {
		e.preventDefault()
		const site_title = document.querySelector('[data-input="site_title"]').value
		const SaveTitle = await fetch('/api/settings', {
			method: 'PUT',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ site_title })
		})
		const Response = await SaveTitle.json()
		ShowMessage({msg: Response.msg, alertClass: 'bg-warning'})
	})
</script>