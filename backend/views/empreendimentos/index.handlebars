<h2 class="mb-5">Empreendimentos <a href="/dashboard/empreendimentos/create" class="btn btn-primary" role="button" data-bs-toggle="button">Adicionar</a></h2>

<table class="table table-striped table-dark table-hover table-bordered table-sm">
	<thead>
		<tr>
			<td scope="col">Título do Anúncio</td>
			<td scope="col">Preço</td>
			<td scope="col">Tipo</td>
			<td scope="col">Cidade</td>
			<td scope="col">Bairro</td>
			<td scope="col">Status</td>
			<td scope="col">#</td>
		</tr>
	</thead>
	<tbody></tbody>
</table>

<script>
	const Empreendimentos = fetch(`http://localhost:3001/api/empreendimentos${document.location.search}`)
	const Tabela = document.querySelector('tbody')

	Empreendimentos.then(data => {
		data.json().then(empreendimentos => {
			const Result = empreendimentos.map(({ _id, title, price, status, type, cidade, bairro }) => {
				const Status = (status ? 'Online' : 'Offline')
				const options = {
					style: 'currency',
					currency: 'BRL',
					minimumIntegerDigits: 2
				}
				const Price = new Intl.NumberFormat('pt-BR', options).format(price)
				const Type = t => {
					const tipos = {
						"1": "Casa",
						"2": "Apartamento",
						"3": "Terreno",
						"4": "Kitnet",
					}
					return tipos[t]
				}
				return (`<tr>
					<td><a href="empreendimentos/show/${_id}" title="Editar empreendimento">${title}</a></td>
					<td>${Price}</td>
					<td><a href="?type=${type}">${Type(type)}</a></td>
					<td><a href="?cidade=${cidade._id}">${cidade.name}</a></td>
					<td><a href="?cidade=${cidade._id}&bairro=${bairro._id}">${bairro.name}</a></td>
					<td><a href="?status=${status}">${Status}</a></td>
					<td class="text-center align-middle">
						<button type="button" class="btn-close btn-close-white erase" aria-label="Close" data-id="${_id}"></button>
					</td>
				</tr>`)
			}).join('')
			Tabela.innerHTML += Result

			// BOTÃO PARA EXCLUIR UM EMPREENDIMENTO
			document.querySelectorAll('.erase').forEach(e => {
				e.addEventListener('click', function (e) {
					prompt('asdasd')
				})
			})
		}).catch(err => console.error(err))
	})
</script>